<?xml version="1.0" encoding="UTF-8"?>
<hibernate-mapping package="org.n52.series.db.beans"
    xmlns="http://www.hibernate.org/xsd/hibernate-mapping"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.hibernate.org/xsd/hibernate-mapping http://www.hibernate.org/xsd/hibernate-mapping/hibernate-mapping-4.0.xsd">
        <subclass name="BlobDataEntity" extends="DataEntity" discriminator-value="blob">
			<join table="value_blob">
                <comment>Storage of the blog observation value. Separate table because the size of a blob value can be huge.</comment>
	            <key foreign-key="fk_blob_value">
	                <column name="fk_observation_id">
                        <comment>Reference to the data/observation in the observation table</comment>
	                </column>
	            </key>
	           <property name="value"
                       type="blob">
                 <column name="value">
                     <comment>The blob value of an observation</comment>
                 </column>
				</property>
            </join>
        </subclass>

        <subclass name="DataArrayDataEntity" extends="DataEntity" discriminator-value="dataarray">
            <set name="value" table="composite_observation" inverse="false" sort="natural" cascade="delete-orphan">
                <comment>Storage of the relation of composite data/observation like Complex(Record)-, Profile- or DataArrayObservation </comment>
                <key foreign-key="fk_composite_observation">
                    <column name="fk_parent_observation_id" not-null="true">
                        <comment>Reference to the parent data/observation</comment>
                    </column>
                </key>
                <many-to-many class="DataEntity" foreign-key="fk_composite_observation_child">
                    <column name="fk_child_observation_id" not-null="true">
                        <comment>Reference to the child data/observation</comment>
                    </column>
                </many-to-many>
            </set>
            <join table="value_data_array">
                <comment>Storage of the data array observation value.</comment>
	            <key foreign-key="fk_data_array_value">
	                <column name="fk_observation_id">
                        <comment>Reference to the data/observation</comment>
                    </column>
	            </key>
	           <property name="structure" type="text">
		            <column name="structure" not-null="true">
                        <comment>The structure of the data array</comment>
                    </column>
		        </property>

		        <property name="encoding" type="text">
		            <column name="encoding" not-null="true">
                        <comment>The encoding of the data array values</comment>
                    </column>
		        </property>
            </join>
        </subclass>

        <subclass name="ComplexDataEntity" extends="DataEntity" discriminator-value="complex">
            <!-- See above comments for DataArrayDataEntity -->
        	<set name="value" table="composite_observation" inverse="false" sort="natural" cascade="delete-orphan">
                <key foreign-key="fk_composite_observation">
                    <column name="fk_parent_observation_id" not-null="true"/>
                </key>
                <many-to-many class="DataEntity" foreign-key="fk_composite_observation_child">
                    <column name="fk_child_observation_id" not-null="true"/>
                </many-to-many>
            </set>
        </subclass>

        <subclass name="ProfileDataEntity" extends="DataEntity" discriminator-value="profile">
            <!-- See above comments for DataArrayDataEntity -->
        	<set name="value" table="composite_observation" inverse="false" sort="natural" cascade="delete-orphan">
				<key foreign-key="fk_composite_observation">
					<column name="fk_parent_observation_id" not-null="true"/>
				</key>
				<many-to-many class="DataEntity" foreign-key="fk_composite_observation_child">
					<column name="fk_child_observation_id" not-null="true"/>
				</many-to-many>
			</set>
        	<join table="value_profile">
                <comment>Storage of the profile observation value.</comment>
	            <key foreign-key="fk_profile_value">
	                <column name="fk_observation_id">
                        <comment>Reference to the data/observation</comment>
                    </column>
	            </key>
	            <property name="verticalFromName" type="string">
	                <column name="vertical_from_name" not-null="false">
                        <comment>The name of the vertical from values, e.g. from or depthFrom</comment>
                    </column>
	            </property>
	            <property name="verticalToName" type="string">
	                <column name="vertical_to_name" not-null="false">
                        <comment>The name of the vertical from values, e.g. to or depthTo</comment>
                    </column>
	            </property>
	            <many-to-one name="verticalUnit" class="UnitEntity" fetch="select" lazy="no-proxy" foreign-key="fk_profile_unit">
	                <column name="fk_vertical_unit_id" not-null="true">
                        <comment>The unit of the vertical value, e.g. m</comment>
                    </column>
	            </many-to-one>
            </join>
        </subclass>
</hibernate-mapping>
